name: Betterer YourProjectName TS Code Quality  # <--- Adapt to your project needs

on:
  push:
    paths:
      - 'src/**/*.tsx?'  # <--- Adapt to your project needs

env:
  PROJECT_NODE_VERSION: 16.3                                 # <--- Adapt to your project needs
  PROJECT_NAME: "platform"                                   # <--- Adapt to your project needs
  CHATOPS_RESULTS_FILE_UPDATE_COMMAND: 'betterer:update'     # <--- Adapt to your project needs
  BETTERER_CONFIG_FILE_PATH: ".betterer"                     # <--- Adapt to your project needs
  BETTERER_RESULTS_FILE_NAME: ".betterer.results"            # <--- Adapt to your project needs
  BETTERER_RESULTS_FILE_PATH: ".betterer.results"            # <--- Adapt to your project needs
  FORCE_COLOR: '1'
  PULL_REQUEST_NUMBER: ${{ github.event.number }}
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

jobs:
  code-quality-check:
    runs-on: ubuntu-18.04  # <--- Adapt to your project needs
    steps:
      - uses: actions/checkout@v2
      - run: |
          touch "pr-request-msg.txt"
          echo "ðŸ¤– BOT: I've detected TypeScript changes not stored in **${{ env.BETTERER_RESULTS_FILE_NAME }}** (project: **${{ env.PROJECT_NAME }}**)\n" >> pr-request-msg.txt
          echo "Here are instructions on how to proceed: https://github.com/${{ github.repository }}/runs/${{ github.job }}?check_suite_focus=true" >> pr-request-msg.txt
          gh pr review $PULL_REQUEST_NUMBER --request-changes --body $(cat pr-request-msg.txt)
      - name: Use Node.js
        uses: actions/setup-node@v1
        with:
          node-version: ${{ env.PROJECT_NODE_VERSION }}
      - name: Install dependencies
        run: yarn --frozen-lockfile --non-interactive --no-progress
      - name: Incremental code quality check
        uses: Evilweed/betterer-github-action@v1.0.0
        with:
          chatops_results_file_update_command: ${{ format('{0}:{1}', env.PROJECT_NAME, env.CHATOPS_RESULTS_FILE_UPDATE_COMMAND) }}
          betterer_results_file_name: ${{ env.BETTERER_RESULTS_FILE_NAME }}
          args: --config "/github/workspace/${{ env.BETTERER_CONFIG_FILE_PATH }}" --results "/github/workspace/${{ env.BETTERER_RESULTS_FILE_PATH }}" --reporter /build/custom-simple-reporter.js

