name: Betterer YourProjectName TS Code Quality  # <--- Adapt to your project needs

on:
  push:
    paths:
      - 'src/**/*.tsx?'  # <--- Adapt to your project needs

env:
  PROJECT_NODE_VERSION: 16.3                                 # <--- Adapt to your project needs
  PROJECT_NAME: "platform"                                   # <--- Adapt to your project needs
  CHATOPS_RESULTS_FILE_UPDATE_COMMAND: 'betterer:update'     # <--- Adapt to your project needs
  BETTERER_CONFIG_FILE_PATH: ".betterer"                     # <--- Adapt to your project needs
  BETTERER_RESULTS_FILE_NAME: ".betterer.results"            # <--- Adapt to your project needs
  BETTERER_RESULTS_FILE_PATH: ".betterer.results"            # <--- Adapt to your project needs
  FORCE_COLOR: '1'
  PULL_REQUEST_NUMBER: ${{ github.event.number }}
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

jobs:
  code-quality-check:
    runs-on: ubuntu-18.04  # <--- Adapt to your project needs
    steps:
      - uses: actions/checkout@v2
      - run: touch "pr-request-msg.txt"
      - run: |
          ### ðŸ¤– BOT: I've detected TypeScript quality changes!
          echo "CI job that compiles this project with "strict'er" compilation detected changes. You have either fixed some TypeScript issues, or added new. You need to review those changes and either fix new TS issues, or accept new changes as "ok" which will store this state in file in repo." >> pr-request-msg.txt
          echo " " >> pr-request-msg.txt
          echo "| Project |" >> pr-request-msg.txt
          echo "| ---- |" >> pr-request-msg.txt
          echo "| ${{ env.PROJECT_NAME }} |" >> pr-request-msg.txt
          echo " " >> pr-request-msg.txt
          echo "| Action  | When to do it  | What, or details |" >> pr-request-msg.txt
          echo "| ---- | ----- | ----- |" >> pr-request-msg.txt
          echo "| 1. See detailed report | Now | Open this [ðŸ”— link to ci job](https://github.com/${{ github.repository }}/runs/${{ env.GITHUB_RUN_ID }}?check_suite_focus=true) and check if there are some new TS errors you can fix. You can decide not to fix those issues - but keep in mind that we are trying to improve TS practices. |" >> pr-request-msg.txt
          echo "| 2. Fix detected issues | The sooner the better :) | Use information from previous step to find TS errors and commit fixes. |" >> pr-request-msg.txt
          echo "| 3. Update `${{ env.BETTERER_RESULTS_FILE_NAME }}` file | Before merge at most | Open this [ðŸ”— link to ci job](https://github.com/${{ github.repository }}/runs/${{ env.GITHUB_RUN_ID }}?check_suite_focus=true) and read instruction on how to update `${{ env.BETTERER_RESULTS_FILE_NAME }}` file |" >> pr-request-msg.txt
      - name: Use Node.js
        uses: actions/setup-node@v1
        with:
          node-version: ${{ env.PROJECT_NODE_VERSION }}
      - name: Install dependencies
        run: yarn --frozen-lockfile --non-interactive --no-progress
      - name: Incremental code quality check
        uses: Evilweed/betterer-github-action@v1.0.0
        with:
          chatops_results_file_update_command: ${{ format('{0}:{1}', env.PROJECT_NAME, env.CHATOPS_RESULTS_FILE_UPDATE_COMMAND) }}
          betterer_results_file_name: ${{ env.BETTERER_RESULTS_FILE_NAME }}
          args: --config "/github/workspace/${{ env.BETTERER_CONFIG_FILE_PATH }}" --results "/github/workspace/${{ env.BETTERER_RESULTS_FILE_PATH }}" --reporter /build/custom-simple-reporter.js

